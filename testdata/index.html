<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
	<meta name="generator" content="Hugo 0.48" />
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Stefan&#39;s Blog &middot; 
    
  </title>

  <script src="https://use.fontawesome.com/84a3d9bd2f.js"></script>

  
  <link rel="stylesheet" href="https://stefan.arentz.ca/css/poole.css">
  <link rel="stylesheet" href="https://stefan.arentz.ca/css/syntax.css">
  <link rel="stylesheet" href="https://stefan.arentz.ca/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://stefan.arentz.ca/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://stefan.arentz.ca/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="Stefan&#39;s Blog" href="https://stefan.arentz.ca/post/index.xml">
  <link rel="feed" type="application/rss+xml" title="Stefan&#39;s Blog" href="https://stefan.arentz.ca/post/index.xml">

</head>


  <body>

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item centered">
    <p><img src="https://stefan.arentz.ca/assets/avatar.jpg">
    Engineering Manager at Mozilla. Hacker at night. I like Dutch cheese and Canadian bacon.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item  active " href="https://stefan.arentz.ca/">Home</a>
    <a class="sidebar-nav-item " href="https://stefan.arentz.ca/post">Posts</a>

    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  </nav>


  <div class="sidebar-item">
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" target="_blank" href="https://twitter.com/satefan"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i>&nbsp; Twitter</a>
    <a class="sidebar-nav-item" target="_blank" href="https://github.com/st3fan"><i class="fa fa-github fa-lg" aria-hidden="true"></i>&nbsp; Github</a>
    <a class="sidebar-nav-item" target="_blank" href="https://keybase.io/st3fan"><i class="fa fa-shield fa-lg" aria-hidden="true"></i>&nbsp; Keybase.io</a>
  </nav>

  

</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://stefan.arentz.ca/" title="Home">Stefan&#39;s Blog</a>
            <small></small>
          </h3>
        </div>
      </div>

      <div class="container content">





<div class="posts">
  
    <div class="post">
        <h1 class="post-title"><a href="https://stefan.arentz.ca/2018/09/21/an-ode-to-sad-mac/">An Ode to Sad Mac</a></h1>
        <span class="post-date">Sep 21 2018</span>
        <p>Here is a more official build of the Sad Mac screen saver that I wrote last year. It is now properly code-signed and should install and run without any permission issues on macOS 10.12 and newer - <a href="https://github.com/st3fan/SadMacScreenSaver/releases/download/v1.1/SadMac.saver.zip">Download SadMac.saver.zip</a></p>

<p><img src="https://stefan.arentz.ca/img/2017-10-20-ScreenSaversSadMac.png" alt="Sad Mac Screen Saver" /></p>

<ul>
<li><a href="https://github.com/st3fan/SadMacScreenSaver/releases/download/v1.1/SadMac.saver.zip">SadMac.saver.zip</a> (Screen Saver)</li>
<li><a href="https://github.com/st3fan/SadMacScreenSaver">github.com/st3fan/SadMacScreenSaver</a> (Source Code)</li>
</ul>

<blockquote>
<p>Most of my work is open source. You
can see all projects at <a href="https://github.com/st3fan">github.com/st3fan</a> - feel free to leave a bug report or open a feature request.</p>
</blockquote>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://stefan.arentz.ca/2017/10/20/screen-savers/">Screen Savers</a></h1>
        <span class="post-date">Oct 20 2017</span>
        

<p>I recently wrote three small screen savers for macOS. That was a ton
of fun. There is something therapeutic about it. I am making them all
available as open source. Let me know what you think.</p>

<h2 id="sad-mac">Sad mac</h2>

<p>This one is an ode to the classic Mac. The Sad Mac would show up if
it&rsquo;s internal hardware test failed. Like when you had a bad RAM chip.</p>

<p><img src="https://stefan.arentz.ca/img/2017-10-20-ScreenSaversSadMac.png" alt="Sad Mac Screen Saver" /></p>

<p>Code-wise it is a very basic screen saver actually. Just drop sprites
on the floor and let them pile up. The thing that took some time was
to get the physics parameters right to make it feel natural.</p>

<ul>
<li><a href="https://github.com/st3fan/SadMacScreenSaver">github.com/st3fan/SadMacScreenSaver</a></li>
<li><a href="https://github.com/st3fan/SadMacScreenSaver/releases/download/v0.1/SadMac.saver.zip">SadMac.saver.zip</a></li>
</ul>

<h2 id="puzzle">Puzzle</h2>

<p>The Sliding Puzzle from After Dark was probably my favorite back in
the day. It just worked so well and smooth. And I think I specially
loved the ones that messed with your actual screen.</p>

<p><img src="https://stefan.arentz.ca/img/2017-10-20-ScreenSaversPuzzle.png" alt="Puzzle Screen Saver" /></p>

<p>My re-implementation simply chops up a screenshot and then turns the
pieces into SpriteKit nodes. Those can then easily be moved
around. SpriteKit is pretty amazing. I have found it very simple to
turn ideas into working prototypes.</p>

<ul>
<li><a href="https://github.com/st3fan/PuzzleScreenSaver">github.com/st3fan/PuzzleScreenSaver</a></li>
<li><a href="https://github.com/st3fan/PuzzleScreenSaver/releases/download/v0.1/Puzzle.saver.zip">Puzzle.saver.zip</a></li>
</ul>

<h2 id="mozilla">Mozilla</h2>

<p>This one shows the new Mozilla logo and drops two sizes of Firefox
(Focus/Nightly) icons on it. There is lots of bouncing and I spin the
logo around if too many pile up.</p>

<p><img src="https://stefan.arentz.ca/img/2017-10-20-ScreenSaversMozilla.png" alt="Mozilla Screen Saver" /></p>

<p>Since the logo is not a simple rectangular bounding box, I had to
create an outline for the collission detection. I used a nice little
web based tool that let me draw the path on top of the image and
generated Objective-C code that.</p>

<ul>
<li><a href="https://github.com/st3fan/MozillaScreenSaver">github.com/st3fan/MozillaScreenSaver</a></li>
<li><a href="https://github.com/st3fan/MozillaScreenSaver/releases/download/v0.1/Mozilla.saver.zip">Mozilla.saver.zip</a></li>
</ul>

<blockquote>
<p>Most of my work is open source. You
can see all projects at <a href="https://github.com/st3fan">github.com/st3fan</a> - feel free to leave a bug report or open a feature request.</p>
</blockquote>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://stefan.arentz.ca/2017/09/20/ewm-update-lets-get-cookin/">EWM Update: Let&#39;s Get Cookin&#39;!</a></h1>
        <span class="post-date">Sep 20 2017</span>
        

<p>Building on top of the <a href="https://stefan.arentz.ca/2017/09/18/ewm-update-lua-integration/">Lua integration
work</a> that I landed recently
in <a href="https://github.com/st3fan/ewm">EWM</a>, my <code>Apple ][+</code> emulator, here
are two small improvements and a fun use case to show those off.</p>

<p><img src="https://stefan.arentz.ca/img/2017-09-20-EWMUpdateLetsGetCookin1.png" alt="EWM Bootloader" /></p>

<h2 id="new-lua-callbacks">New Lua Callbacks</h2>

<p>First, I have added two callbacks that let you intercept key
presses. Not emulated presses, but EWM application key downs and
ups. This means that you can now trigger scripts by connecting them to
a key combination.</p>

<p>For example, say you want to dump the Zero Page when you hit
<em>Command-Z</em>. That is now easy with just a few lines of code:</p>

<pre><code>two:onKeyDown(function(two, mod, sym)
   if mod == KMOD_GUI then -- Command on macOS and Meta on Linux
      if sym == string.byte('z') then
         ewm:hexdump(0x0000, 0xff) -- Dump the zero page
         return true
      end
   end
end)
</code></pre>

<p>(The KMOD_GUI constant comes from <a href="https://www.libsdl.org">SDL</a>. I
hope to have some abstraction for that at some point.)</p>

<p>Second, it is now possible to inspect and modify memory. The <code>cpu</code>
global now has a <code>memory</code> property that you can index as an array:</p>

<pre><code>-- Set the memory location at $300
cpu.memory[0x0300] = 1

-- Read the RESET vector
v = bit32.bor(cpu.memory[0xfffc], bit32.lshift(cpu.memory[0xfffd], 8))
</code></pre>

<p>(Bitwise operations in Lua are a bit of a pain unfortunately. I will
probably introduce a more convenient API to access 16 bit values.)</p>

<h2 id="let-s-build-a-cheat-for-burger-time">Let&rsquo;s build a cheat for Burger Time</h2>

<p>Combined, these two new features can be used to build little cheats
for games. Let&rsquo;s try to build one for
<a href="https://en.wikipedia.org/wiki/BurgerTime">BurgerTime</a>.</p>

<p>First let&rsquo;s see if we can find where the game stores the number of
chefs and pepper shots and see if we can modify those values.</p>

<p>So with this zero page dumper example in place, we hit <em>Command-Z</em>
when the game has started. This is what we see:</p>

<pre><code>0000: 1d 02 ae 1d 0c 00 d0 33 28 77 ae 00 00 b8 00 00
0010: 60 56 d5 00 00 00 00 00 00 00 00 00 00 00 00 00
0020: 00 02 00 b6 01 0a 00 00 01 00 01 01 63 10 0b 57
0030: a2 02 00 00 00 00 00 a3 1b fd 09 09 01 01 01 33
0040: 17 00 00 00 00 0c 07 00 00 09 e6 05 00 00 00 00
0050: 04 00 ea 00 00 00 00 00 00 00 00 00 00 00 00 00
0060: 73 96 00 00 3f 96 05 05 00 00 05 05 00 00 07 00
0070: 00 00 00 00 00 00 83 00 00 00 00 00 00 e2 a1 00
0080: 89 9a ab 9a 26 3d 3f 96 7f 7f 00 00 00 0f 25 1d
0090: 00 00 ff 07 00 1b 0f 03 1b 01 00 1a 0f 00 19 0f
00a0: 00 18 0f 0a 00 c1 00 00 00 00 00 00 00 00 00 00
00b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00d0: 00 0c 00 00 02 00 5c c6 00 00 00 00 00 00 00 00
00e0: c0 92 00 92 04 00 00 2e d0 3d 50 2a 50 26 50 22
00f0: d0 35 d0 39 00 17 00 00 00 00 00 00 00 00 eb 1c
</code></pre>

<p>What we are looking for is the value <code>05</code> for the number of lives or
the number of pepper shots we have left. There are multiple
occurences, so what we do is run into an enemy and see if the value
changes somewhere:</p>

<p>Easily spotted, the value at <code>0x66</code> changed from <code>0x05</code> to <code>0x04</code>.</p>

<pre><code>...
0060: 73 96 00 00 3f 96 04 05 00 00 05 05 00 00 07 00
...                     ^^
</code></pre>

<p>And if we get caught once more, by Mr. Pickle, and then use four
pepper shots, the values at <code>0x66</code> and <code>0x6a</code> look like this:</p>

<pre><code>...
0060: 73 96 00 00 3f 96 03 05 00 00 01 05 00 00 07 00
...                     ^^          ^^
</code></pre>

<p>I think we can safely say that we have found the following memory
locations:</p>

<pre><code>CUR_LIVES = 0x66
MAX_LIVES = 0x67
CUR_SHOTS = 0x6a
MAX_SHOTS = 0x6b
</code></pre>

<p>How do we change them? Simple, we can define another key combo that
simply resets the memory locations to a bigger number:</p>

<pre><code>two:onKeyDown(function(two, mod, sym)
   if mod == KMOD_GUI then
      if sym == string.byte('r') then
         cpu.memory[CUR_LIVES] = 7
         cpu.memory[MAX_LIVES] = 7
         cpu.memory[CUR_SHOTS] = 7
         cpu.memory[MAX_SHOTS] = 7
         return true;
      end
   end
   return false
end)
</code></pre>

<p>Now every time you press <em>Command-R</em>, your lives and pepper shots are
set to 7.</p>

<p><img src="https://stefan.arentz.ca/img/2017-09-20-EWMUpdateLetsGetCookin2.png" alt="EWM Bootloader" /></p>

<p>We can take this one step further and simply make sure that the
<code>CUR_LIVES</code> and <code>CUR_SHOTS</code> never changes at all.</p>

<p>There are only a few instructions to store a value in the <em>Zero Page</em>,
so with a little bit of trial and error it is pretty easy to find out
that the values are set with an <code>STA $66,X</code> and <code>STA $6A,X</code>
instructions.</p>

<p>We can intercept those instructons by setting up a callback with
<code>onBeforeExecuteInstruction</code> and then in the callback we make sure
that the value is always <code>0x05</code>:</p>

<pre><code>STA_zpg_X = 0x95 -- Opcode for STA $NN,X

cpu:onBeforeExecuteInstruction(STA_zpg_X, function(cpu, op, oper)
   -- If we are modifying the known locations ...
   if oper == CUR_LIVES or oper == CUR_SHOTS then
      cpu.a = 5 -- ... always store 0x05
   end
end)
</code></pre>

<p>Now when the chef gets caught, the number of lives just stays the
same. Same with the pepper shots.</p>

<p>Note that we have not actually looked at the Burger Time code at
all. We have just inspected memory and made a guess about how it
changes those values. No disassembly required!</p>

<blockquote>
<p>If you are interested in playing around with my emulator, you can find
the project at <a href="https://github.com/st3fan/ewm">github.com/st3fan/ewm</a>.</p>
</blockquote>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://stefan.arentz.ca/2017/09/18/ewm-update-lua-integration/">EWM Update: Lua Integration</a></h1>
        <span class="post-date">Sep 18 2017</span>
        <p>After an almost eight month interruption by mostly work and life in
general, I am finally, and happily, back here writing about something
new I added to <a href="https://github.com/st3fan/ewm"><em>EWM</em>, my Apple II+
emulator</a>.</p>

<p>I always thought it would be interesting to integrate a scripting
language in the emulator, so that you can write little (or big) hacks
to modify the behaviour of not just the emulator but also the software
it runs.</p>

<p>Today I made a gentle start with that with <a href="https://github.com/st3fan/ewm/pull/148">Introduce Lua Support
#148</a>, which lays the
foundation for <em>Lua 5.2</em> support into <em>EWM</em>.</p>

<p>For this release I have only implemented instruction interception;
this means you can run a Lua function before or after a specific
6502/65C02 instruction is executed.</p>

<p>That is not super exciting but it does open the door to some cool and
simple hacks that were previously only possible by patching software
the hard way. Now you can run a script on top of the original software
without having to make persistent modifications.</p>

<p>In later releases I am also going to make it possible to intercept
reads and writes to memory, interact with <em>EWM</em>, and maybe even more
specific things like callbacks for things that happen in the disk
controller.</p>

<p>Here is a small example function that uses the
<code>onAfterExecuteInstruction</code> callback to change the keybindings for
Frogger.</p>

<pre><code>--
-- Frogger.lua - Change the default Frogger key bindings. It uses A/Z
-- and the arrow keys to move around, but we prefer J/L and I/K
-- instead.
--
-- A typical loop to wait for a key press looks like this:
--
--   GETKEY: LDA $C000   ; AD 00 C0
--           CMP #$80    ; C9 80
--           BCC GETKEY  ; 90 F9
--           STA $C010   ; 8D 10 C0
--
-- Load the value from $C000, and if it is greater than $80, a new
-- key press was recorded. To clear this value, strobe $C010.
--
-- So to change key input, all we have to do is intercept the LDA
-- $C000 and look at the value in the accumulator and change it to a
-- new value.
--

LDA_abs = 0xad
KBD = 0xc000

cpu:onAfterExecuteInstruction(LDA_abs, function(cpu, opcode, operand)
   if operand == KBD then
      if cpu.a == 0xc9 then
         cpu.a = 0xc1 -- I -&gt; A
      elseif cpu.a == 0xcb then
         cpu.a = 0xda -- K -&gt; Z
      elseif cpu.a == 0xca then
         cpu.a = 0x88 -- J -&gt; Left
      elseif cpu.a == 0xcc then
         cpu.a = 0x95 -- L -&gt; Right
      end
   end
end)
</code></pre>

<p>I have filed some tickets under the <a href="https://github.com/st3fan/ewm/issues?q=is%3Aissue+is%3Aopen+label%3Alua">lua</a> tag for followup work.</p>

<blockquote>
<p>If you are interested in playing around with my emulator, you can find
the project at <a href="https://github.com/st3fan/ewm">github.com/st3fan/ewm</a>.</p>
</blockquote>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://stefan.arentz.ca/2017/01/22/ewm-update-bootloader/">EWM Update: Bootloader</a></h1>
        <span class="post-date">Jan 22 2017</span>
        <p>I just landed a <a href="https://github.com/st3fan/ewm/pull/134">patch</a> that
adds a bootloader to <em>EWM</em>. Now when you start it without telling it
what specific machine to emulate, you will see the following:</p>

<p><img src="https://stefan.arentz.ca/img/2017-01-22-EWMUpdateBootloader.png" alt="EWM Bootloader" /></p>

<p>There is no support for a Character ROM that has lowercase so you have
to be a little creative when you use the Github link in it. Or maybe I
should make the link clickable?</p>

<p>This is most likely how the <em>Raspberry Pi</em> edition of <em>EWM</em> will
start. Which may actually be the first thing I release to the general
public.</p>

<blockquote>
<p>If you are interested in playing around with my emulator, you can find
the project at <a href="https://github.com/st3fan/ewm">github.com/st3fan/ewm</a>.</p>
</blockquote>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://stefan.arentz.ca/2017/01/16/ewm-update-optimizing-memory-access/">EWM Update: Optimizing Memory Access</a></h1>
        <span class="post-date">Jan 16 2017</span>
        

<p>I landed a <a href="https://github.com/st3fan/ewm/commit/8800bf2b9f4948d8d043f48406b1c3d71fc3fe7d">little patch to optimize memory
access</a>
to the first two pages of memory: the zero page and the stack.</p>

<p>The <code>struct cpu_t</code> now keeps pointers to the memory areas where these
pages are kept, so operations on them can access the memory directly
instead of going through the memory abstraction.</p>

<p>The speedup is specially noticable on the Raspberry Pi Zero:</p>

<h3 id="before">Before</h3>

<pre><code>pi@raspberrypi:~/Projects/ewm/src $ ./cpu_test
TEST Running 6502 tests
TEST   Success; executed 88957316 cycles in 8.7700 at 10.1434 MHz
TEST Running 65C02 tests
TEST   Success; executed 65094140 cycles in 6.2140 at 10.4754 MHz
</code></pre>

<h3 id="after">After</h3>

<pre><code>pi@raspberrypi:~/Projects/ewm/src $ ./cpu_test
TEST Running 6502 tests
TEST   Success; executed 88957316 cycles in 6.0150 at 14.7892 MHz
TEST Running 65C02 tests
TEST   Success; executed 65094140 cycles in 4.2930 at 15.1629 MHz
</code></pre>

<p>That is a pretty big jump in unthrottled CPU speed. I think this
patch, together with the <a href="https://github.com/st3fan/ewm/pull/121">Software
Renderer</a> that I still have in
progress will make <em>EWM</em> run pretty well on the <em>Raspberry Pi Zero</em>.</p>

<p>If you are interested in playing around with my emulator, you can find
the project at <a href="https://github.com/st3fan/ewm">github.com/st3fan/ewm</a>.</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://stefan.arentz.ca/2017/01/13/ewm-update-small-things/">EWM Update: Small Things</a></h1>
        <span class="post-date">Jan 13 2017</span>
        

<p>Here is an overview of some small improvements I made this week. It
has been hard to find quality time to work on this project so I am not
going as fast as during the Christmas break.</p>

<h2 id="blink-that-cursor">Blink that cursor</h2>

<p>The Apple 1 emulation in EWM now blinks the cursor. I did not know
that it blinked until I saw some videos on YouTube.</p>

<div class="embed video-player">
<video autoplay loop>
  <source src="https://stefan.arentz.ca/img/2017-01-13-EWMUpdateSmallFixes.mp4" type="video/mp4"/>
</video>
</div>



<p>I probably got the frequency wrong.</p>

<h2 id="control-keys">Control keys</h2>

<p>In the <code>Apple ][+</code> emulation, I now properly support <code>Control-A</code> to <code>Control-Z</code>. I tested this with the <em>Apple II+ Dealer Diagnostics</em> disk, which has a keyboard hardware test program. There is no date on it, but it is probably 1978 or so.</p>

<p><img src="https://stefan.arentz.ca/img/2017-01-13-EWMUpdateSmallFixes.png" alt="" /></p>

<h2 id="disk-images-in-nib-format">Disk images in <code>.nib</code> format</h2>

<p>EWM can now load disk images in the <code>.nib</code> format. This is a format
that does not just contain a dump of the track and sector
data. Instead it has the raw encoded disk contents. It turned out that
is the exact same internal format that EWM uses for the disk emulation
code, so this was a pretty simple thing to do.</p>

<p>If you are interested in playing around with my emulator, you can find
the project at <a href="https://github.com/st3fan/ewm">github.com/st3fan/ewm</a>.</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://stefan.arentz.ca/2017/01/07/ewm-update-raspberry-pi-zero/">EWM Update: Raspberry Pi Zero</a></h1>
        <span class="post-date">Jan 7 2017</span>
        <p>It has been difficult to find the time to hack on <em>EWM</em> since I went
back to work. Busy busy. But I did manage to make some small
improvements to better support the <em>Raspberry Pi Zero</em>.</p>

<p><img src="https://stefan.arentz.ca/img/2017-01-07-EWMUpdateRaspberryPiZero.png" alt="Raspberry Pi Zero on an Apple IIe" /></p>

<p>The <a href="https://www.raspberrypi.org/products/pi-zero/">Raspberry Pi Zero</a>
is a tiny single board computer with a 1 GHz single-core ARMv6 CPU,
512MB RAM and HDMI and USB connections. They are cheap, around $7
CAD plus shipping, and are capable of running Linux.</p>

<p>Sounds ideal for an emulator. But how fast are they?</p>

<p>To find out, I modified the <code>cpu_test</code> program included with <em>EWM</em> to
output the raw CPU speed:</p>

<pre><code>pi@raspberrypi:~/Projects/ewm/src $ ./cpu_test
TEST Running 6502 tests
TEST   Success; executed 88957316 cycles in 8.7700 at 10.1434 MHz
TEST Running 65C02 tests
TEST   Success; executed 65094140 cycles in 6.2140 at 10.4754 MHz
</code></pre>

<p>So about 10x the speed of an <em>Apple ][+</em>. Not bad, considering I have
spent zero time optimizing the CPU emulation so far. And it is all
written in simple portable C without crazy tricks.</p>

<p>Graphics is more interesting. The <em>Pi Zero</em> has no hardware
accelerated graphics, at least not supported in Linux, so I have been
working on a pure software renderer for text, lores and hires
screen. It does not depend on OpenGL and just blits pixels to screen
buffers.</p>

<p>This is what the performance looks like when I run the <code>scr_test</code>
program:</p>

<pre><code>pi@raspberrypi:~/Projects/ewm/src $ ./scr_test
txt_full_refresh      green      95.103/refresh
txt_full_refresh      color      24.554/refresh
lgr_full_refresh      green      17.619/refresh
lgr_full_refresh      color      17.648/refresh
hgr_full_refresh      green      19.561/refresh
hgr_full_refresh      color      35.250/refresh
</code></pre>

<p>(<em>Green</em> is monochrome mode, and it is slower for text because the way
I let SDL change the color of the default white text
characters. Probably easy to fix.)</p>

<p>The default scheduler in <em>EWM</em> is set to 30 FPS, which means one
timeslot in the &lsquo;scheduler&rsquo; is 33 milliseconds.</p>

<p>Of those we will need about 5 milliseconds for executing enough CPU
instructions and another 5 for random stuff that happens in the event
loop.</p>

<p>That leaves just about enough time for a full screen refresh. But it
is a bit tight and I&rsquo;ll be working on getting those numbers down. It
will be better if all modes render in at most 20 milliseconds or so.</p>

<p>Work in progress at <a href="https://github.com/st3fan/ewm/issues/120">github.com/st3fan/ewm/issues/120</a></p>

<p>If you are interested in playing around with my emulator, you can find
the project at <a href="https://github.com/st3fan/ewm">github.com/st3fan/ewm</a>.</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://stefan.arentz.ca/2016/12/30/ewm-update-linux-support/">EWM Update: Linux Support</a></h1>
        <span class="post-date">Dec 30 2016</span>
        <p><em>Emulated Woz Machine</em>, my Apple 1 / Apple ][+ emulator now runs succesfully on Linux. Here is a screenshot of it running on Ubuntu 16.04.1.</p>

<p><img src="https://stefan.arentz.ca/img/2016-12-30-EWMUpdateRunningOnLinux.png" alt="EWM Running on Linux" /></p>

<p>This was not very difficult to get going. Using <a href="https://wiki.libsdl.org/FrontPage">SDL
2.0</a> to abstract everything screen,
keyboard and event loop related was a good call.</p>

<p>I wrote this emulator in portable C, using just SDL and POSIX
APIs. There were just a few small compilation issues that I had to
fix. Mostly differences between <a href="http://clang.llvm.org">Clang</a> and
<a href="https://gcc.gnu.org">GCC</a>.</p>

<p>If you are interested in playing around with my emulator, you can find
the project at <a href="https://github.com/st3fan/ewm">github.com/st3fan/ewm</a>.</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://stefan.arentz.ca/2016/12/28/ewm-update-boot-loader/">EWM Update: Boot Loader</a></h1>
        <span class="post-date">Dec 28 2016</span>
        <p>EWM supports multiple machine profiles. Currently the Apple 1, Replica
1 and the Apple ][+. You can start an emulator with a specific machine
profile easily from the command line:</p>

<pre><code>ewm one --model=replica1
ewm two --model=apple2plus --drive1=choplifter.dsk
</code></pre>

<p>This is useful, but I think there is probably a more common case where
people start the emulator by double clicking or tapping an app icon or
maybe even auto-boot it on a Raspberry Pi.</p>

<p>So I am thinking about implementing a simple boot loader that runs
when you start <em>EWM</em> without any arguments. Here is a first try:</p>

<p><img src="https://stefan.arentz.ca/img/2016-12-28-EWMUpdateBootLoader.png" alt="EWM Boot Loader" /></p>

<p>(Eventually I would like to be able to fully save and restore the state
of the emulator and give people the option to start from a saved
emulator.)</p>

<p>If you are interested in playing around with my emulator, you can find
the project at <a href="https://github.com/st3fan/ewm">github.com/st3fan/ewm</a>.</p>

    </div>
  
</div>

<div class="pagination">
  
  <a class="pagination-item older" href="https://stefan.arentz.ca/page/2/">Older</a>
  

  
  <span class="pagination-item newer">Newer</span>
  
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-8826435-1', 'auto');
    ga('send', 'pageview');
  </script>

</html>

